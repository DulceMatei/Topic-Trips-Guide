@page
@model Licenta.Pages.Trasee.EditareTraseuPersonalizatModel

@{
    ViewData["Title"] = "Editare Traseu Personalizat";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.IsPersonalizat = true;
}

@section Styles {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        .editare-personalizat-page {
            background-color: #f8f9fa;
        }

            .editare-personalizat-page #map-container {
                min-height: 550px;
                height: 100%;
                border-radius: 1rem;
            }

            .editare-personalizat-page #view-route-btn {
                background-color: #4a90e2;
                border-color: #4a90e2;
                color: white;
            }

                .editare-personalizat-page #view-route-btn:hover {
                    background-color: #357ab8;
                    border-color: #357ab8;
                }

            .editare-personalizat-page .btn-outline-primary {
                color: #4a90e2;
                border-color: #4a90e2;
                background-color: white;
            }

                .editare-personalizat-page .btn-outline-primary:hover {
                    background-color: #4a90e2;
                    color: white;
                }

            .editare-personalizat-page #google-maps-link {
                background-color: #45b97c;
                border-color: #45b97c;
                color: white;
            }

                .editare-personalizat-page #google-maps-link:hover {
                    background-color: #379f69;
                    border-color: #379f69;
                }

            .editare-personalizat-page #pdf-complet-btn {
                background-color: #e74c3c;
                border-color: #e74c3c;
                color: white;
            }

                .editare-personalizat-page #pdf-complet-btn:hover {
                    background-color: #c0392b;
                    border-color: #c0392b;
                }

            .editare-personalizat-page .route-layout {
                display: flex;
                gap: 2rem;
            }

            .editare-personalizat-page .left-panel {
                flex: 0 0 300px;
            }

            .editare-personalizat-page .right-panel {
                flex: 1;
            }

            .editare-personalizat-page .controls-section {
                display: flex;
                gap: 2rem;
                margin-top: 1.5rem;
                flex-wrap: wrap;
            }

                .editare-personalizat-page .controls-section .card {
                    flex: 1 1 400px;
                }

            .editare-personalizat-page .card {
                border-radius: 1rem;
            }

            .editare-personalizat-page .card-body {
                padding: 1rem 1.25rem;
            }

            .editare-personalizat-page .btn {
                border-radius: 0.75rem !important;
            }

            .editare-personalizat-page .btn-danger, .editare-personalizat-page .btn-success, .editare-personalizat-page .btn-info, .editare-personalizat-page .btn-outline-primary, .editare-personalizat-page .btn-outline-secondary {
                white-space: nowrap;
            }

            .editare-personalizat-page .list-group-item {
                border: none;
                border-bottom: 1px solid #e0e0e0;
            }

            .editare-personalizat-page .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }

            .editare-personalizat-page #location-list .btn-info, .editare-personalizat-page #disponibile-list .btn-info {
                background-color: #00bcd4;
                border-color: #00bcd4;
                color: white;
            }

            .editare-personalizat-page #calc-route-btn {
                background-color: #6ba015;
                color: white;
                display: block;
                margin: 0 auto;
            }

            .editare-personalizat-page .btn-personalizeaza {
                background-color: #95d82a;
                border-color: #95d82a;
                color: white;
            }

                .editare-personalizat-page .btn-personalizeaza:hover {
                    background-color: #7fbf1f;
                    border-color: #7fbf1f;
                }

            .editare-personalizat-page #locationDetailsModal .modal-body p {
                margin-bottom: 0.5rem;
                font-size: 0.95rem;
                color: #444;
            }

            .editare-personalizat-page #locationDetailsModal h5 {
                font-size: 1.2rem;
                font-weight: bold;
            }

            .editare-personalizat-page #locationDetailsModal .form-control {
                font-size: 0.9rem;
                border-radius: 0.5rem;
            }

            .editare-personalizat-page #locationDetailsModal button[type="submit"] {
                background-color: #007bff;
                border-radius: 0.5rem;
            }

            .editare-personalizat-page #location-list .btn-danger, .editare-personalizat-page #disponibile-list .btn-danger {
                background-color: #e74c3c;
                border-color: #e74c3c;
            }

            .editare-personalizat-page #disponibile-list .btn-success {
                background-color: #8bc34a;
                border-color: #8bc34a;
            }

        @@media (max-width: 992px) {
            .editare-personalizat-page .route-layout, .editare-personalizat-page .controls-section

        {
            flex-direction: column;
        }

        .editare-personalizat-page .left-panel,
        .editare-personalizat-page .right-panel,
        .editare-personalizat-page .controls-section .card {
            width: 100%;
        }

        }
    </style>
}

@section Scripts {
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="/js/editareTraseuPersonalizat.js?v=@DateTime.Now.Ticks"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/leaflet-image/leaflet-image.js"></script>
}

<div class="editare-personalizat-page">
    <h2 class="text-center mt-4">Editare Traseu Personalizat</h2>

    <div class="container-fluid py-3">
        <div id="status-message" class="alert d-none" role="alert" aria-live="polite"></div>

        <div class="route-layout">
            <div class="left-panel">
                <div class="card shadow-sm">
                    <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Locații</h4>
                        <small class="text-muted">Trage pentru a reordona</small>
                    </div>
                    <div id="location-list-container">
                        <ul id="location-list" class="list-group list-group-flush"></ul>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="transport-mode" class="form-label">Mod de transport:</label>
                                <select id="transport-mode" class="form-select">
                                    <option value="driving-car" selected>Mașină</option>
                                    <option value="cycling-regular">Bicicletă</option>
                                    <option value="foot-walking">Mers pe jos</option>
                                </select>
                            </div>
                            <div class="alert alert-info text-center">
                                Distanță totală: <span id="distance-value">Se calculează...</span> km | Durată: <span id="duration-value">Se calculează...</span>
                            </div>
                            <button id="calc-route-btn" class="btn btn-outline-secondary">Salvează traseu personalizat</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="mb-4">
                    <div id="map-container" class="map shadow-sm w-100" role="region" aria-label="Hartă interactivă a traseului"></div>
                </div>

                <div class="card rounded-4 shadow-sm mb-4">
                    <div class="card-body d-flex flex-wrap gap-2 justify-content-center">
                        <button id="view-route-btn" class="btn btn-primary">Vezi tot traseul</button>
                        <a id="google-maps-link" href="#" target="_blank" class="btn btn-success d-none">Vezi traseul complet pe Google Maps</a>
                        <button type="button" id="pdf-complet-btn" class="btn btn-danger">
                            <i class="fas fa-file-pdf"></i> Descarcă PDF complet
                        </button>
                    </div>
                </div>

                <div class="card rounded-4 shadow-sm">
                    <div class="card-body">
                        <h6>Locații disponibile pentru adăugare</h6>
                        <ul id="disponibile-list" class="list-group"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal detalii locatie -->
    <div class="modal fade" id="locationDetailsModal" tabindex="-1" aria-labelledby="locationDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="locationDetailsModalLabel">Detalii locație</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Închide"></button>
                </div>
                <div id="review-status-message" class="alert d-none mt-3" role="alert"></div>
                <div class="modal-body">
                    <div id="modal-location-content"></div>
                    <div id="modal-rating-summary" class="mt-3 p-3 border rounded bg-light shadow-sm d-none" style="max-width: 500px;"></div>
                    <hr>
                    <ul id="modal-review-list" class="list-group mb-3"></ul>
                    <form id="review-form">
                        <div class="mb-2">
                            <label for="review-rating" class="form-label">Rating (1-5):</label>
                            <input type="number" id="review-rating" class="form-control" min="1" max="5" required />
                        </div>
                        <div class="mb-2">
                            <label for="review-comment" class="form-label">Comentariu:</label>
                            <textarea id="review-comment" class="form-control" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Trimite recenzie</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>